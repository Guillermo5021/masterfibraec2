<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tienda MasterFibraEC</title>

  <script type="module">
    // ======= CONFIGURACI√ìN FIREBASE =======
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB5OQhX5_Uu3lunMBxcOqQL4yHhe-vdXzA",
      authDomain: "masterfibraec.firebaseapp.com",
      projectId: "masterfibraec",
      storageBucket: "masterfibraec.firebasestorage.app",
      messagingSenderId: "568089252571",
      appId: "1:568089252571:web:db36ba765eaa45029c32fe"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ======= GUARDAR PEDIDO =======
    async function guardarPedido() {
      const nombre = document.getElementById("nombre").value.trim();
      const email = document.getElementById("email").value.trim();
      const producto = document.getElementById("producto").value.trim();
      const total = parseFloat(document.getElementById("total").value);

      if (!nombre || !email || !producto || isNaN(total)) {
        alert("‚ö†Ô∏è Por favor completa todos los campos correctamente.");
        return;
      }

      try {
        const fecha = new Date().toISOString().split("T")[0];

        // Guardar pedido en Firebase
        const docRef = await addDoc(collection(db, "orders"), {
          nombre,
          email,
          productos: producto,
          total,
          fecha
        });

        const idPedido = docRef.id;

        // ======= PLANTILLA DUE√ëO =======
        const mensajeDue√±o = `
          <div style="font-family:Arial,sans-serif;max-width:600px;margin:auto;border:1px solid #e1e1e1;border-radius:10px;padding:20px;">
            <img src="https://i.imgur.com/Jxqph1L.png" alt="MasterFibraEC" style="max-width:180px;margin-bottom:20px;">
            <h2 style="color:#1a73e8;">üöÄ Nuevo pedido recibido</h2>
            <p>Se ha registrado un nuevo pedido desde la tienda:</p>
            <table style="border-collapse:collapse;width:100%;max-width:500px;">
              <tr><td style="padding:8px;border-bottom:1px solid #ddd;">üì¶ <b>ID Pedido:</b></td><td style="padding:8px;border-bottom:1px solid #ddd;">${idPedido}</td></tr>
              <tr><td style="padding:8px;border-bottom:1px solid #ddd;">üë§ <b>Cliente:</b></td><td style="padding:8px;border-bottom:1px solid #ddd;">${nombre}</td></tr>
              <tr><td style="padding:8px;border-bottom:1px solid #ddd;">‚úâÔ∏è <b>Email:</b></td><td style="padding:8px;border-bottom:1px solid #ddd;">${email}</td></tr>
              <tr><td style="padding:8px;border-bottom:1px solid #ddd;">üõ† <b>Producto:</b></td><td style="padding:8px;border-bottom:1px solid #ddd;">${producto}</td></tr>
              <tr><td style="padding:8px;border-bottom:1px solid #ddd;">üìÖ <b>Fecha:</b></td><td style="padding:8px;border-bottom:1px solid #ddd;">${fecha}</td></tr>
              <tr><td style="padding:8px;border-bottom:1px solid #ddd;">üí∞ <b>Total:</b></td><td style="padding:8px;border-bottom:1px solid #ddd;">$${total.toFixed(2)}</td></tr>
            </table>
            <p style="margin-top:25px;color:#555;font-size:14px;">üìä Puedes revisar este pedido en tu panel de <b>Firebase ‚Üí Firestore ‚Üí orders</b>.</p>
            <hr style="margin:25px 0;">
            <p style="font-size:12px;color:#888;">Este correo se gener√≥ autom√°ticamente desde el sistema de pedidos de <b>MasterFibraEC</b>.</p>
          </div>
        `;

        // ======= PLANTILLA CLIENTE =======
        const mensajeCliente = `
          <div style="font-family:Arial,sans-serif;max-width:600px;margin:auto;border:1px solid #e1e1e1;border-radius:10px;padding:20px;">
            <img src="https://i.imgur.com/Jxqph1L.png" alt="MasterFibraEC" style="max-width:180px;margin-bottom:20px;">
            <h2 style="color:#1a73e8;">¬°Gracias por tu pedido, ${nombre}! üíô</h2>
            <p>Hemos recibido tu pedido correctamente. A continuaci√≥n los detalles:</p>
            <table style="border-collapse:collapse;width:100%;max-width:500px;">
              <tr><td style="padding:8px;border-bottom:1px solid #ddd;">üßæ <b>N¬∞ Pedido:</b></td><td style="padding:8px;border-bottom:1px solid #ddd;">${idPedido}</td></tr>
              <tr><td style="padding:8px;border-bottom:1px solid #ddd;">üõ† <b>Producto:</b></td><td style="padding:8px;border-bottom:1px solid #ddd;">${producto}</td></tr>
              <tr><td style="padding:8px;border-bottom:1px solid #ddd;">üìÖ <b>Fecha:</b></td><td style="padding:8px;border-bottom:1px solid #ddd;">${fecha}</td></tr>
              <tr><td style="padding:8px;border-bottom:1px solid #ddd;">üí∞ <b>Total:</b></td><td style="padding:8px;border-bottom:1px solid #ddd;">$${total.toFixed(2)}</td></tr>
            </table>
            <p style="margin-top:20px;font-size:14px;color:#555;">Nos pondremos en contacto contigo pronto para confirmar el env√≠o.</p>
            <div style="margin-top:25px;text-align:center;">
              <a href="https://wa.me/593995783624" style="background:#25d366;color:white;padding:10px 20px;border-radius:8px;text-decoration:none;font-weight:bold;">üí¨ Contactar por WhatsApp</a>
            </div>
            <p style="text-align:center;margin-top:20px;font-size:13px;color:#777;">
              S√≠guenos en redes:<br>
              <a href="https://www.instagram.com/masterfibraec" style="color:#1a73e8;text-decoration:none;">üì∏ Instagram</a> |
              <a href="https://masterfibraec.com" style="color:#1a73e8;text-decoration:none;">üåê Sitio Web</a>
            </p>
            <hr style="margin:25px 0;">
            <p style="text-align:center;font-size:12px;color:#888;">¬© 2025 MasterFibraEC. Todos los derechos reservados.</p>
          </div>
        `;

        // ======= Enviar al due√±o =======
        await fetch("https://formsubmit.co/ajax/guillermosimancas95@gmail.com", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
          },
          body: JSON.stringify({
            _subject: "Nuevo Pedido Recibido - MasterFibraEC üöÄ",
            message: mensajeDue√±o,
            _template: "table"
          }),
        });

        // ======= Enviar al cliente =======
        await fetch(`https://formsubmit.co/ajax/${email}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
          },
          body: JSON.stringify({
            _subject: "Confirmaci√≥n de tu pedido - MasterFibraEC üßæ",
            message: mensajeCliente,
            _template: "table"
          }),
        });

        alert("‚úÖ Pedido guardado correctamente y correos enviados.");
        document.getElementById("formPedido").reset();
      } catch (error) {
        console.error("Error al guardar pedido:", error);
        alert("‚ùå Ocurri√≥ un error al procesar el pedido.");
      }
    }

    window.guardarPedido = guardarPedido;
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f9fc;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 480px;
      margin: 60px auto;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #1a73e8;
      margin-bottom: 25px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 5px;
    }
    button {
      background-color: #1a73e8;
      color: white;
      border: none;
      padding: 12px;
      width: 100%;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.3s ease;
    }
    button:hover {
      background-color: #155ab6;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Formulario de Pedido</h1>
    <form id="formPedido" onsubmit="event.preventDefault(); guardarPedido();">
      <label>Nombre:</label>
      <input type="text" id="nombre" required />

      <label>Correo electr√≥nico:</label>
      <input type="email" id="email" required />

      <label>Producto:</label>
      <input type="text" id="producto" required />

      <label>Total ($):</label>
      <input type="number" id="total" required />

      <button type="submit">Enviar Pedido</button>
    </form>
  </div>
</body>
</html>